# 本地服务器使用指南

## 简介

本指南介绍如何使用新的本地服务器方案，该方案使用实际的 clang 编译器来执行 C++ 代码，提供与终端一致的交互体验。

## 优势

- **真实的编译器**：使用系统安装的 clang 编译器，支持完整的 C++ 标准
- **交互式输入**：支持使用 `cin` 等交互式输入功能
- **实时输出**：代码执行过程中的输出会实时显示
- **性能优化**：相比 WebAssembly 编译器，执行速度更快
- **安全性**：内置输入验证和资源限制，确保安全运行

## 系统要求

- Node.js 14.0 或更高版本
- clang++ 编译器（macOS 已预装）
- 网络连接（仅用于初始依赖安装）

## 安装步骤

### 1. 安装依赖

在 IDE 根目录运行以下命令安装所需依赖：

```bash
npm install
```

### 2. 启动本地服务器

```bash
npm start
```

服务器会在以下地址运行：
- HTTP 服务：http://localhost:3000
- WebSocket 服务：ws://localhost:3000

### 3. 启动开发服务器

保持本地服务器运行，然后在另一个终端窗口启动开发服务器：

```bash
python3 -m http.server 8000
```

### 4. 访问 IDE

在浏览器中打开：http://localhost:8000

## 使用方法

### 编写代码

在编辑器中编写 C++ 代码，例如：

```cpp
#include <iostream>
using namespace std;

int main() {
    int a, b;
    cout << "请输入两个整数：" << endl;
    cin >> a >> b;
    cout << "它们的和是：" << a + b << endl;
    return 0;
}
```

### 运行代码

1. 点击 "运行" 按钮
2. 如果代码包含交互式输入，终端会提示你输入数据
3. 输入完成后，代码会继续执行并显示结果

### 查看输出

- 编译错误：会在终端中显示详细的编译错误信息
- 运行时输出：会实时显示在终端中
- 执行结果：会显示程序的最终输出和执行时间

## 故障排除

### 1. 服务器启动失败

- 检查 Node.js 是否已正确安装
- 检查 clang++ 是否已正确安装（运行 `clang++ --version` 验证）
- 检查端口 3000 是否已被占用

### 2. 代码无法编译

- 确保代码语法正确
- 确保使用了标准的 C++ 语法
- 检查编译错误信息，根据提示修复问题

### 3. 交互式输入不工作

- 确保本地服务器正在运行
- 确保浏览器支持 WebSocket
- 尝试刷新浏览器页面

### 4. 程序执行超时

- 检查代码是否包含无限循环
- 优化代码逻辑，减少执行时间
- 注意：默认执行超时时间为 5 秒

## 安全限制

为确保服务器安全运行，系统对代码执行有以下限制：

- **代码长度**：最大 100KB
- **编译时间**：最大 10 秒
- **运行时间**：最大 5 秒
- **输出缓冲区**：最大 1MB
- **危险操作**：禁止使用系统命令、文件操作、网络操作等危险功能

## 技术原理

1. **前端**：使用 WebSocket 与本地服务器通信
2. **服务器**：接收代码，使用 clang++ 编译，然后执行编译后的程序
3. **通信**：通过 WebSocket 实时传输输入输出数据
4. **容错**：如果 WebSocket 连接失败，会自动回退到 WebAssembly 编译器

## 常见问题

### Q: 为什么需要本地服务器？

A: WebAssembly 编译器在处理交互式输入（如 `cin`）时存在限制，本地服务器使用实际的 clang 编译器，可以提供与终端一致的交互体验。

### Q: 本地服务器会影响性能吗？

A: 不会，相反，本地服务器使用实际的编译器，执行速度通常比 WebAssembly 编译器更快。

### Q: 如何停止服务器？

A: 在运行服务器的终端窗口中，按 `Ctrl+C` 停止服务器。

### Q: 服务器会在后台运行吗？

A: 不会，服务器会在终端窗口中运行，关闭终端窗口会停止服务器。

## 总结

本地服务器方案提供了一种更强大、更灵活的方式来执行 C++ 代码，特别是对于需要交互式输入的程序。通过遵循本指南的步骤，你可以充分利用这一新功能，获得与终端一致的编程体验。